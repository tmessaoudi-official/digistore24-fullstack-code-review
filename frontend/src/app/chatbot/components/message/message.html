<div class="mb-3">

  @if (message.replies && message.replies.length > 0) {
  <div class="ml-6 mt-2 space-y-2 border-l-2 border-gray-200 pl-4">
    @for (reply of message.replies; track reply.id) {
    <app-message [message]="reply"></app-message>
    }
  </div>
  }

  <div class="p-4 rounded-lg shadow-sm transition-all hover:shadow-md" [ngClass]="{
             'bg-white': message.status === 'sent',
             'bg-blue-50': message.status === 'received',
             'bg-gray-100': message.status === 'draft',
             'bg-yellow-50': message.status === 'pending',
             'bg-red-50': message.status === 'failed'
           }">
    <div class="flex justify-between items-start mb-2">
      <span class="text-xs font-semibold text-gray-600">
        {{ message.user }}
      </span>
      <span class="text-xs px-2 py-1 rounded-full" [ngClass]="{
                  'bg-green-200 text-green-800': message.status === 'sent',
                  'bg-blue-200 text-blue-800': message.status === 'received',
                  'bg-gray-200 text-gray-800': message.status === 'draft',
                  'bg-yellow-200 text-yellow-800': message.status === 'pending',
                  'bg-red-200 text-red-800': message.status === 'failed'
                }">
        {{ getStatusLabel() }}
      </span>
    </div>
    <div class="text-gray-900 break-words" [ngClass]="{'text-gray-500': message.status === 'draft'}">
      {{ message.message }}
    </div>
    <div class="text-xs text-gray-400 mt-2">
      {{ formatTimestamp(message.created_at) }}
    </div>
  </div>
</div>